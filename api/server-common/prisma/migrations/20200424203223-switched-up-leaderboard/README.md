# Migration `20200424203223-switched-up-leaderboard`

This migration has been generated by Salvatore at 4/24/2020, 8:32:23 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."GlobalLeaderboardEntry" DROP CONSTRAINT IF EXiSTS "GlobalLeaderboardEntry_leaderboardEntryId_fkey",
DROP COLUMN "leaderboardEntryId",
ADD COLUMN "aliveTime" integer  NOT NULL ,
ADD COLUMN "damageGiven" integer  NOT NULL ,
ADD COLUMN "damageTaken" integer  NOT NULL ,
ADD COLUMN "enemiesKilled" integer  NOT NULL ,
ADD COLUMN "eventsParticipatedIn" integer  NOT NULL ,
ADD COLUMN "sessionId" text  NOT NULL ,
ADD COLUMN "shotsFired" integer  NOT NULL ,
ADD COLUMN "userId" integer  NOT NULL ;

ALTER TABLE "public"."ServerLeaderboardEntry" DROP CONSTRAINT IF EXiSTS "ServerLeaderboardEntry_leaderboardEntryId_fkey",
DROP COLUMN "leaderboardEntryId",
ADD COLUMN "aliveTime" integer  NOT NULL ,
ADD COLUMN "damageGiven" integer  NOT NULL ,
ADD COLUMN "damageTaken" integer  NOT NULL ,
ADD COLUMN "enemiesKilled" integer  NOT NULL ,
ADD COLUMN "eventsParticipatedIn" integer  NOT NULL ,
ADD COLUMN "sessionId" text  NOT NULL ,
ADD COLUMN "shotsFired" integer  NOT NULL ,
ADD COLUMN "userId" integer  NOT NULL ;

ALTER TABLE "public"."GlobalLeaderboardEntry" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."ServerLeaderboardEntry" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

DROP TABLE "public"."LeaderboardEntry";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200418200807-more-fields..20200424203223-switched-up-leaderboard
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator client {
   provider = "prisma-client-js"
@@ -21,34 +21,35 @@
   createdAt          DateTime         @default(now())
   serverId           Int
   server             Server           @relation(fields: [serverId], references: [id])
   score              Int
-  leaderboardEntryId Int
-  leaderboardEntry   LeaderboardEntry @relation(fields: [leaderboardEntryId], references: [id])
-}
+  sessionId            String
+  userId               Int
+  user                 User   @relation(fields: [userId], references: [id])
+  aliveTime            Int
+  damageGiven          Int
+  damageTaken          Int
+  enemiesKilled        Int
+  eventsParticipatedIn Int
+  shotsFired           Int
+  }
 model GlobalLeaderboardEntry {
   id                 Int              @default(autoincrement()) @id
   createdAt          DateTime         @default(now())
   score              Int
-  leaderboardEntryId Int
-  leaderboardEntry   LeaderboardEntry @relation(fields: [leaderboardEntryId], references: [id])
-}
-
-model LeaderboardEntry {
-  id                   Int    @default(autoincrement()) @id
   sessionId            String
   userId               Int
   user                 User   @relation(fields: [userId], references: [id])
   aliveTime            Int
-  calculatedScore      Int
   damageGiven          Int
   damageTaken          Int
   enemiesKilled        Int
   eventsParticipatedIn Int
   shotsFired           Int
 }
+
 model Server {
   id        Int      @default(autoincrement()) @id
   createdAt DateTime @default(now())
   updatedAt DateTime @default(now())
```


